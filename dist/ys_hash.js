// Generated by CoffeeScript 1.7.1
(function() {
  var Ys_hash,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  Ys_hash = (function() {
    function Ys_hash() {
      this.set_mask_len = __bind(this.set_mask_len, this);
      this.set_symbols = __bind(this.set_symbols, this);
      this.set_symbols("0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-._!'()*");
      this.set_mask_len(32);
    }

    Ys_hash.prototype.set_symbols = function(str) {

      /*
      			Control the char set.
       */
      return this.symbols = str.split('');
    };

    Ys_hash.prototype.set_mask_len = function(len) {

      /*
      			If you want shorter hash, this is the api.
       */
      if (len > 32) {
        len = 32;
      }
      this.init_sum = Math.pow(2, (len - len % 2) / 2);
      this.roll_len = len - 1;
      return this.mask = 0xffffffff >>> (32 - len);
    };

    Ys_hash.prototype.hash = function(data, is_number) {
      var h;
      if (is_number == null) {
        is_number = false;
      }

      /*
      			Auto check the data type and choose the corresponding method.
       */
      if (typeof data === 'string') {
        h = this.hash_str(data);
      } else if (Buffer.isBuffer(data) || Array.isArray(data)) {
        h = this.hash_arr(data);
      }
      h = h >>> 0;
      if (is_number) {
        return h;
      } else {
        return this.to_str(h);
      }
    };

    Ys_hash.prototype.hash_arr = function(arr) {

      /*
      			Also can hash a file buffer.
       */
      var h, i, _i, _len;
      h = this.init_sum;
      for (_i = 0, _len = arr.length; _i < _len; _i++) {
        i = arr[_i];
        h = this.sum(h, i);
      }
      return h;
    };

    Ys_hash.prototype.hash_str = function(str) {
      var h, i, len;
      h = this.init_sum;
      i = 0;
      len = str.length;
      while (i < len) {
        h = this.sum(h, str.charCodeAt(i++));
      }
      return h;
    };

    Ys_hash.prototype.sum = function(h, v) {
      return ((h << 1 | h >>> this.roll_len) & this.mask) ^ v;
    };

    Ys_hash.prototype.to_str = function(num) {
      var base, s, str;
      str = '';
      base = this.symbols.length;
      while (num >= base) {
        s = num % base;
        str = this.symbols[s] + str;
        num = (num - s) / base;
      }
      str = this.symbols[num] + str;
      return str;
    };

    return Ys_hash;

  })();

  if (typeof module === 'undefined') {
    window.ys_hash = new Ys_hash;
  } else {
    global.Ys_hash = Ys_hash;
    module.exports = new Ys_hash;
  }

}).call(this);
